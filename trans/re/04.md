# 第四章量词

在前一章中，我们研究了在搜索文本中匹配字符的各种选项；但是，这些示例假设我们知道正在搜索的字符的确切数量。在本章中，我们将探索如何搜索不同长度的模式。

## 花括号{}

花括号元字符允许您指定特定字符集出现的次数。举个简单的例子，让我们从上一章中获取我们的 euro regex，并使它成为一个更通用的货币搜索。

首先，我们想要一个符号，在这种情况下是欧元、英镑或美元符号。`[\u20AC\u00A3$]`后接至少一位数字，但不超过五位数字，后接句号，两位数字。`\d{1,5}\.\d\d`

`\d`字符后面的`{1,5}`表示我们至少需要一个，但在货币符号之后和句点之前不超过五位数。我们的花括号选项可以是:

*   {n} -前面的字符必须正好出现“n”次。
*   {n，} -至少“n”次，但没有上限。
*   {n，m} -介于“n”和“m”次之间。

请注意，使用`{,n}`不会搜索 0 到“n”次之间的值，而是被解释为文字值。如果可以接受 0 次出现，需要精确指定，即`{0,}`。

### 示例

为了重温前一章中的一些例子，这里有一些例子。

社会保险号

我们的 SSN 检验器可以从`[0-9][0-9][0-9][-\.][0-9][0-9][-\.][0-9][0-9][0-9][0-9]`简化为`\d{3}-\d{2}-\d{4}`。

邮政区码

我们的邮政编码+4 验码器可以从`\d\d\d\d\d[-][0-9][0-9][0-9][0-9]`改进到`\d{5}-{0,1}\d{0,4}`。然而，即使这个表达式得到了改进，并且将处理五位邮政编码和邮政编码+4，它也不是完美的，因为它将匹配五位数字后跟破折号，五位数字后跟破折号，然后少于四位数字。

| ![](../Images/tip.png) | 提示:无论何时构建正则表达式模式，在测试程序中运行它总是明智的，以确保它符合您的期望。随着模式变得越来越复杂，你可能会发现一些意想不到的匹配。 |

现在结合我们的前两章，让我们构建一个正则表达式模式，看看我们是否能从我们的消息中提取时间。我们知道，时间从 1 到 12 之间的数字开始，可以选择后跟一个冒号，然后是两个数字，第一个数字在 0 到 5 之间，第二个数字在 0 到 9 之间。最后，应该以 AM 或 PM 结尾，不区分大小写。

表 5:时间模式

| 英国规则 | 正则模式 |
| 可能从 0 或 1 开始 | [0-1]{0,1} |
| 需要号码吗 | `\d` |
| 和一个结肠 | `:` |
| 介于 0 和 5 之间的数字 | `[0-5]` |
| 介于 0 和 9 之间的数字 | `[0-9]` |
| 可选的空白字符 | `\s{0,1}` |
| 不区分大小写的 a 或 p | `[aApP]` |
| 不区分大小写 m | `[Mm]` |

生成的正则表达式模式为`[0-1]{0,1}\d:[0-5][0-9]\s{0,1}[aApP][Mm]`，将匹配以下时间:晚上 7:30，晚上 12:45，早上 6:45 等。虽然它并不完美，但它是否非常接近(并将在后面的章节中更接近)。不幸的是，它也将匹配晚上 19:00，这是一个无效的时间，但根据定义的模式规则，看起来仍然可以。

## 贪婪与懒惰量词

除了使用花括号指定您将接受的出现次数之外，还有其他可用的量词。然而，要使用这些量词，区分贪婪和懒惰的量词是很重要的。例如，假设我们正在解析一个 HTML 文件，我们想要从字符串中移除<>标签。我们在文中遇到的第一行是**T3】b>财务报告< /b >。**我们需要编写一个正则表达式模式来找到(并最终移除)这些标签。

### 贪婪

我们的第一次尝试可能是这样的`<.{0,}>`，意思是找到一个字面上的 **<** 符号，然后是 0 个或更多的任意字符，接着是字面上的 **>** 符号。然而，在处理该正则表达式时，我们得到以下结果:< b >财务报告< /b >。在这种情况下，返回了整个字符串。这是一个贪婪量词的例子。贪婪的量词取整个字符串，看它是否能匹配模式。由于整个字符串与模式匹配，正则表达式返回整个字符串(它以 **<** 符号开始，包含任意数量的字符，并以 **>** 符号结束)。

默认情况下，花括号中的所有量词都是贪婪的。取整个字符串，看看是否匹配。如果没有，它会一次回溯一个字符，直到找到匹配的为止。

贪婪的量词是相当耗费资源的。他们拿起整根绳子进行测试。如果不匹配，该过程将备份一个字符，并检查是否找到匹配。这个过程还会跟踪它在哪里，以防它需要回到先前的位置进行搜索。

如果我们的示例缺少最后一个 **>** 字符，正则表达式引擎将对照模式检查以下所有字符串。

1.  **财务报告**
2.  **财务报告**
3.  **财务报告**
4.  **财务报告<**
5.  等等…

 **虽然这个例子显示了 20 个不同的字符串，想象一下如果你的正则表达式方法试图处理整个 HTML 文件。

### 懒惰

懒惰的量词使用相反的方法。它从文本的开头开始查找匹配项。我们可以通过在任何花括号量词后面加上问号来让它变懒。所以如果我们把我们的模式`<.{0,}>`改成`<.{0,}?>`我们会得到不同的结果，在这种情况下:< b >财务报告< /b >。regex 引擎找到了 **<** ，字母 **b** ，以及 **>** ，所以找到了匹配。自从我们使用了全局选项后，引擎不停的读取，最终找到了另一个 **<** ，后面是 2 个字符 **/b** ，后面是 **>** 符号。

### 所有格

所有格量词的操作就像贪婪量词一样，只是它不会回溯。如果整个字符串与模式匹配，则返回匹配。否则，匹配失败。你可以在量词后面加一个+使它成为所有格量词。但是，微软正则表达式引擎不支持所有格量词。但是，您可以指示 regex 组不要回溯，使其像所有格量词一样操作。

当匹配失败时，所有格量词提供了比贪婪量词更大的速度提升。一个贪婪的量词说:“如果一开始没有成功，那就努力，再努力。”一个所有格量词说:“如果一开始你没有成功，就放弃吧，做一个傻瓜是没有意义的。”

## 量词符号

虽然您可以使用{}符号来指定匹配的数量，但是还有三个常用的量词符号。记住默认情况下，他们是贪婪的，试图尽可能匹配。

表 6:常用量词

| 数量词 | 比赛 | 等同于 |
| `*` | 匹配零次或更多次 | `{0,}` |
| `+` | 匹配一次或多次 | `{1,}` |
| `?` | 匹配零次或一次 | `{0,1}` |

要使以上任何一项变得懒惰，请在量词后立即添加问号。为了回顾我们的例子，让我们看看**财务报告**字符串将如何匹配。这假设是全局的，即返回所有可能的匹配。

表 7:财务报告字符串

| 模式 | 结果 |
| <./> | **财务报告** |
| <./> | **财务报告** |
| <./> | **财务报告** |
| <./> | **财务报告** |
| <./> | **财务报告** |
| <./> | **财务报告** |

请注意，使用问号量词(与{0，1}相同)不会匹配最终的标记，因为它在< and >字符之间包含两个字符。

| ![](../Images/note.png) | 注意:注意*量词。\d*可能看起来应该匹配任何数字，但是它将匹配所有内容，因为 0 数字的模式将总是在搜索字符串中找到。匹配对象将返回“成功”属性“真”，但“值”属性将是空字符串，“索引”和“长度”都将为零。 |

## 总结

在这一章中，我们介绍了量词字符，允许您搜索不同长度的字符串。下表 8 总结了量词。

表 8:量词

| **字符** | **描述** |
| --- | --- |
| `{n}` | 前面的模式恰好出现 n 次 |
| `{n,}` | 至少 n 次，但没有上限 |
| `{n,m}` | n 到 m 倍之间 |
| `*` | 匹配零次或更多次，与{0，}相同 |
| `+` | 匹配一次或多次，与{1，}相同 |
| `?` | 匹配零或一次，与{0，1}相同 |**