# 第 2 章使用您的 PowerPivot 模型

创建一个粗糙且现成的 PowerPivot 模型是探索数据的一个很好的方法，但是大多数时候，如果你想把它们放在管理层面前或与同事分享，这些最初的探索需要一点润色。

## 整理一下

有一些简单的事情你可以做，使模型本身更像样一点。

### 数字格式

首先，任何数字或数据列都可以对数字应用格式。在数据模型的“主页”选项卡上，有一个“格式”部分:

![](../Images/image069.png)

图 68:主页选项卡上功能区的格式部分

根据您的数据类型，您可以获得不同的选项—实际上，您只能将格式应用于数字和日期列。例如，我们可以将十进制数字格式应用于 UnitsIn，去掉小数，这样在该列的数字中就会有千位分隔符。

重要的是，您在数据模型中应用的任何格式都将流向几个地方。首先，直接对该列进行的任何简单计算都将继承该格式，因此您的单位总和也将具有该格式(然而，我们在行级别的复杂公式不会)。

更重要的是，这种格式还会传递到任何使用该数据的东西上，例如数据透视表或图表。下图说明了这一点:

![](../Images/image070.png)

图 69:从数据模型流过的格式

这是避免在表格和图表中应用大量格式的一种快速简单的方法。

### 友好的名字

接下来您可以轻松调整的是表和字段的名称。大多数数据源的名称都适用于数据库或其他数据存储系统，但不适用于人类。例如，我们在数据透视表中浏览模型的起始视图如下所示:

![](../Images/image071.png)

图 70:用原始名称浏览数据

例如，大多数商业用户可能更喜欢看到“产品”而不是“DimProduct”。重命名表很简单。在网格视图的底部，每个表在一个选项卡上都有它的名称:

![](../Images/image072.jpg)

图 71:网格视图选项卡中的表名

我们可以快速双击每个选项卡并重命名表:

![](../Images/image073.jpg)

图 72:网格视图中重命名的表

这些名字在商业上更友好一些。但是，请注意，在“产品”选项卡上，我们收到了公式错误警告。重命名表不会自动传递到公式中，所以你可以很容易地把模型搞得一团糟。在导入数据时，通常更容易设置友好名称。

列也可以被赋予友好的名称。您可以在几个地方实现这一点，或者在网格视图中双击列标题，或者在图表视图中双击列名。使用图表视图通常更有效，因为您可以在更小的屏幕空间内看到所有的列。

下图显示了在图表视图中重命名列的效果:

![](../Images/image074.png)

图 73:重命名列

这使得模型更加形象，因为您可以将技术名称转化为业务用户能够理解的术语。

### 隐藏表格和列

下一步是隐藏模型的组件，这将使与模型共享的用户的体验变得复杂。这可以在表级别和单个列级别完成。

要隐藏表格，右键单击表格名称并选择**从客户端工具**中隐藏:

![](../Images/image075.jpg)

图 74:隐藏表格

这将使表在图表视图(略灰)和网格视图(选项卡名称灰)中可见，但在创建数据透视表时不可用。当您的工作表(如重量转换表)本身对最终用户分析没有用处，但支持其他地方需要的计算或关系时，这可能会很有用。

同样，对于图表视图中的列，您可以右键单击单个列并选择**从客户端工具中隐藏**。

![](../Images/image076.png)

图 75:隐藏列

列名将被着色，就像隐藏表一样，现在在数据透视表中不可用于分析。这有一个类似的用例，因为有些列(如上面示例中的“键”列)对最终用户分析没有价值，但需要支持关系和计算。

最终结果会流向我们的数据透视表和图表，因此我们在浏览数据时会获得更清晰的体验:

![](../Images/image077.png)

图 76:名称变化流向数据透视表字段列表

## 透视表

一旦我们整理了我们的数据模型，我们就可以用它来创建一些漂亮的报表，使用数据透视表和图表。

我们已经使用数据透视表做了一些基本的探索，所以让我们看看 PowerPivot 在 Excel 中启用或增强的几个关键特性。枢纽图在功能上几乎没有改变，所以我们不会在这本书里看到它们。

### 关键绩效指标

关键绩效指标是任何仪表板的标准功能，通常采用红绿灯格式，因此仪表板用户可以快速了解哪些关键绩效指标表现良好，哪些表现不佳。

PowerPivot 本身就支持关键绩效指标，作为计算变体的一部分。如果我们在网格下面的区域选择一个单元格，我们可以添加一个 KPI。首先，我们需要创建一个计算；正如您将在功能区的“主页”选项卡的“计算”部分注意到的，“创建关键绩效指标”选项是阴影的:

![](../Images/image078.png)

图 77:带灰色创建关键绩效指标选项的功能区的计算选项卡

我们将对单位余额进行任意计算——在本例中为平均值。Autosum 选项为我们提供了以下公式:

单位余额平均值:=平均值([单位余额])

重要的是，我们现在看到“创建关键绩效指标”选项亮起:

![](../Images/image079.png)

图 78:启用“创建关键绩效指标”的功能区的“计算”选项卡

在突出显示计算的同时点击**创建关键绩效指标**选项，为我们提供一个配置关键绩效指标的对话框:

![](../Images/image080.jpg)

图 79:配置关键绩效指标

有三个关键部分需要处理:

*   定义目标值:这是关键绩效指标目标，因此这将是目标销量，例如。
*   定义状态阈值:这是您设置关键绩效指标变为红色、黄色或绿色的界限的地方。
*   选择图标样式:这是您选择客户端工具将呈现的图形的地方(如果支持)。

我们的指标只是一个例子，所以我们的阈值除了证明效果之外没有任何意义。我们像以前一样更新设置，然后点击**确定**。

计算现在在网格视图中得到一点关键绩效指标装饰:

![](../Images/image081.png)

图 80: KPI 装饰上的一个计算

为了演示这在 Excel 中是什么样子，我们将创建一个简单的透视表，每行都有颜色。当我们转到透视表字段查找计算时，我们可以看到它的显示方式发生了变化:

![](../Images/image082.png)

图 81:数据透视表字段列表中的关键绩效指标

在交通灯图标下，我们可以看到我们有一个选项来查看度量的值、目标(如果您设置了动态目标，这可能很重要)和状态(由图标表示)。选择这三个选项会在数据透视表中显示出来:

![](../Images/image083.jpg)

图 82:数据透视表中的关键绩效指标

KPI 的有效显示以前是留给高端的 dashboarding 工具的，不过承蒙 PowerPivot，可以用 Excel 管理！

### 切片器

切片器是自 2010 年以来推出的数据透视表[【23】](6.html#_ftn23)的基本功能。它们允许对数据进行快速直观的过滤，与本机数据透视表相比，PowerPivot 能更好地处理这些数据。

在指向我们的数据模型的数据透视表字段部分，展开日历层次结构，右键单击**年**并选择**添加为切片器**选项:

![](../Images/image084.jpg)

图 83:向透视表添加切片器

在我们的数据透视表中，在行上添加**备用子类别**，并将**单位余额**作为值。我们将看到这个带有切片器的数据透视表:

![](../Images/image085.jpg)

图 84:带切片器的旋转工作台

从这里有几件事需要注意。首先，切片器在顶部列出该透视表的有效值。当添加切片器开始时，在透视表有任何其他数据之前，它只是列出了从 1900 年到 2100 年的所有年份。现在它有了一些上下文，有效值(2005-2008)列在顶部。所有其他值仍会显示，但带有阴影。要注意的第二件事是，当您选择不同的值时，它的速度有多快——即使数据集有 75 万行，响应时间也是瞬间的。

切片器在其他方面也非常灵活，尤其是因为您可以将它们附加到多个数据透视表和图表中，以驱动一些华而不实的交互式报告。切片器带来的交互性——特别是过滤掉无关值的智能——使得构建令人印象深刻且直观的交互式报告变得容易。

## 电源视图

Excel (2013 & Office 365 专业版 Plus)的另一个鲜为人知的功能是数据可视化工具 Power View[【24】](6.html#_ftn24)。这是一个丰富的交互式工具，可以轻松浏览您的数据并创建一些令人印象深刻的报告。

要创建基本报告，请单击功能区的**插入**选项卡上的**电源视图**按钮。这将在工作簿的新选项卡中启动高级视图(您可能需要在首次使用时安装 Silverlight)。

![](../Images/image086.png)

图 85:功能区上的电源视图

“电源视图”报告界面分为三个功能区域:

![](../Images/image087.jpg)

图 86:电源视图报告表面

区域 1 是实际的报告画布，数据将在其中显示。区域 2 用于对整个报告应用过滤器(例如，如果您想将数据缩减到一个区域或时间段)。区域 3 是字段列表，在选择要使用的数据项方面，它的功能与数据透视表中的字段列表非常相似。

Power View 的设计是为了更简单地构建报告，您所做的任何事情都不应该超过两次点击，并且大多数操作都是拖放操作。

要创建一个简单的数据表，请将日历层次结构的**年**级别拖到报表设计图面上:

![](../Images/image088.png)

图 PowerView 表面上的年份层次结构

然后在同一个框中，从产品库存中拖动度量中的**单位:**

![](../Images/image089.png)

图 88:将度量添加到 PowerView 报表表面的表中

创建基本表。请注意为度量单位指定的格式是如何传递到报表中的。

![](../Images/image090.png)

图 89:一个基本的 PowerView 表

现在我们可以玩得开心了。让我们先把它转换成条形图。选择表格，在功能区的**设计**选项卡上，点击开关可视化部分的**条形图**，选择**堆叠条形图**:

![](../Images/image091.png)

图 90:在电源视图中更改图表类型

生成的图表有点被压扁了，所以通过拖动右下角，我们可以将其调整到更易读的大小:

![](../Images/image092.png)

图 91:电源视图中的条形图

目前为止还不错。你可以看到图表也给了自己一个有意义的标题。现在我们可以演示 Power View 的交互性。在设计图面的右侧，从“产品”中拖动**颜色**属性，然后拖动到出现“产品库存单位”的表格中。然后选择图表上的一个项目，并将可视化切换到**饼图**。

这就是有趣的地方。单击饼图中最大类别的部分，黑色。您将看到左边的图表自动过滤黑色产品:

![](../Images/image093.jpg)

图 92:电源视图中的交叉过滤报告项目

反之亦然——如果你点击左侧图表中的一个条，饼图的结果将被过滤。底层数据模型中的关系支持这种用户友好的交叉过滤，而用户根本不需要专业知识。另外它看起来很光滑！

### 牌

想要使用图像创建极具视觉吸引力的报告吗？Power View 支持将数据模型中的图像作为卡片[【25】](6.html#_ftn25)合并到报告中，如下所示:

![](../Images/image094.jpg)

图 93:包含图像的电源视图卡

在这里，我们引入了嵌入产品数据集中的图像，并将它们与一些数据集属性和指标一起显示在报表上。

为了获得这个功能，需要对保存图像的表格进行一些调整。在数据模型的高级选项卡上，有一个报告属性部分。点击**表格行为**选项:

![](../Images/image095.png)

图 94:功能区“高级”选项卡上的报告属性

这将启动“表格行为”对话框，该对话框需要配置一些设置。以下示例根据我们的需要填写了它们:

![](../Images/image096.jpg)

图 95:表格行为对话框

关键设置是设置唯一的行标识符 **—** ProductKey 为我们工作 **—** 和默认图像。在模型中，“大照片”列包含图像，尽管它显示在网格视图中，如下所示:

![](../Images/image097.png)

图 96:网格视图中的二进制数据

使用这些设置，可以将“大照片”列拖到“超级视图”报表表面并显示为图像。然后，使用卡片可视化可以实现本节开始时演示的那种报告。

### 地图

另一个令人印象深刻的可视化是地图数据。这里有一个简单的例子:

![](../Images/image098.jpg)

图 97: PowerView 地图示例

这张地图是根据以下简单数据集构建的:

表 2:地图示例数据集

| **`Suburb`** | **`Value`** | **`Category`** |
| 澳大利亚新南威尔士州悉尼 | ten thousand | 东方 |
| 澳大利亚布里斯班 | Two thousand | 东方 |
| 澳大利亚霍巴特 | Three thousand | 未知的 |
| 澳大利亚墨尔本 | Seven thousand six hundred | 南方 |
| 澳大利亚珀斯 | Five thousand six hundred | 西 |
| 澳大利亚凯恩斯 | One thousand two hundred | 东方 |
| 澳大利亚阿德莱德 | Eight thousand nine hundred | 南方 |

表 2:地图示例数据集

需要立即注意的一件事是，数据尚未进行地理编码。Power View 获取位置数据并将其发送给 Bing 进行地理编码，因此只要 Bing 理解它，它就可以在地图上为它创建一个点。这意味着有时您需要向数据中添加一些额外的细节来获得正确的结果。例如，伯明翰镇在英国最有名，但也存在于美国阿拉巴马州。通常建议用州和国家数据扩展地址数据，以获得正确的结果。

这些地图可以放大和缩小，以给出适当的比例。它们确实有一些局限性——主要是可视化仅限于地图上的圆圈(您可以将圆圈细分为饼图，但这种可视化除了在极少数情况下对于传达信息基本上没有用)。您可以按类别给圆圈着色(就像我们在前面的示例中使用“类别”列所做的那样)，这是对圆点应用一些区分的最有意义的方法。然而，这依赖于每个点只属于一个类别；否则，刚才讨论的饼图效应就会发挥作用。