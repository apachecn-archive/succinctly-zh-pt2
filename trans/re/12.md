# 第 12 章用正则表达式替换文本

微软 Regex 类提供了一个**替换**的方法来根据正则表达式的结果更新文本。这个方法有许多重载，为替换文本提供了很大的灵活性。可以对正则表达式对象或静态正则表达式类(需要将正则表达式模式作为参数传递)调用 Replace()方法。

## 替换()

“替换”最简单的变体是获取一个源字符串，并用替换字符串替换任何匹配的模式。如果我们想从一个字符串中删除多余的空格(用一个空格替换所有多个空格)，我们可以创建一个像 **\s{2，}** 这样的正则表达式模式，它寻找至少出现两次的任何空格。然后，我们使用两个字符串的 Replace()方法。

**替换(源字符串，替换为)**

这是为了找到模式的所有匹配项，并用替换字符串替换它。

```cs
      Regex ExtraSpaces = new Regex(@"\s{2,}");

      string SourceInput = "Ben  &   Jerry's makes great ice cream...";
      string TweakedResult = ExtraSpaces.Replace(SourceInput, " ");

```

上面的原始字符串是:本和杰瑞做了很棒的冰淇淋...

结果串起来是:本和杰瑞做了很棒的冰淇淋...

再举一个例子，删除字符串中的所有美元符号和逗号，使其成为一个数值。

```cs
      Regex ExtraSpaces = new Regex(@"[$,]");

      string SourceInput = "$12,750.00";
      string TweakedResult = ExtraSpaces.Replace(SourceInput, "");

      // Returns 12750.00

```

除了第二个字符串是模式之外，静态方法的工作方式是相同的，因此使用静态方法的货币清理器如下所示:

```cs
      string SourceInput = "$12,750.00";
      string TweakedResult = Regex.Replace(@SourceInput, @"[$,]", "");

      // Returns 12750.00

```

### 使用组

如果正则表达式模式创建了组(或子模式)，您可以在替换文本参数中通过名称或编号引用这些组。例如，让我们来看一个简单的电话号码 regex，它只处理格式为“xxx-xxx-xxxx”的电话号码。我们将把区号和电话号码分成不同的组。我们的正则表达式如下:

**`(?<area>\d{3})[- ](?<phone>\d{3}-\d{4})`**

我们可以创建一个替换字符串来创建一个格式化的电话号码，它由区号周围的括号、一个空格和七位数(带破折号)组成。

```cs
      string SourceInput = "610-867-5309";
      string TweakedResult = Regex.Replace(@SourceInput,
      @"(?<area>\d{3})-(?<phone>\d{3}-\d{4})", "($1) $2");

      // Returns (610) 867-5309

```

我们也可以使用 **${group}** 来引用组名而不是组号。这可以使替换文本更加清晰。

```cs
      string SourceInput = "610-867-5309";
      string TweakedResult = Regex.Replace(@SourceInput,
      @"(?<area>\d{3})-(?<phone>\d{3}-\d{4})",
      "(${area}) ${phone}");

      // Returns (610) 867-5309

```

当试图按照某些标准清理数据时，这种类型的替换非常方便。我们将在下一章提供一些例子。

## 其他替换()参数

除了简单的字符串示例之外，还有许多额外的重载方法来控制替换操作。

### 指定正则表达式选项

如果使用静态方法替换字符串，可以添加第四个参数，即要应用的 regex 选项。这允许您在调用替换时设置选项，而不是在使用类方法实例化对象时。

***替换(源字符串、模式、替换为、正则表达式)***

### 指定超时(。NET 4.5 及以上版本)

如果使用静态方法替换字符串，可以添加第五个参数，它是一个 timespan 对象。这允许您设置允许正则表达式运行的持续时间。如果你打算让你的用户创建一个正则表达式模式，我会建议增加时间跨度，以防止一个设计不良的模式回溯到遗忘。

***替换(源字符串、模式、替换为、正则表达式、时间跨度)***

### 控制替换次数

创建 regex 对象时，可以添加第三个 integer 类型的参数，而不是使用静态方法。此参数告诉 Replace 方法允许进行的最大替换次数。

***替换(sourceString，ReplaceWith，maxreplaces)***

### 控制从哪里开始搜索

创建 regex 对象时，还可以添加第四个整数类型的参数。此参数告知搜索在输入字符串中的开始位置。

***替换(sourceString，ReplaceWith，maxreplaces，StartAt )***

请注意，在此语法中，您可以使用-1 来表示不限制允许的替换次数。

## 总结

Replace 方法允许您基于正则表达式模式和替换字符串创建新字符串。清理数据和创建标准化结果非常有用。在下一章中，我们将使用 regex 和 Replace()来完成程序员清理数据的常见任务。