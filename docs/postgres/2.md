# 二、为什么是 Postgres

考虑到这本书是由一家. NET 工具公司出版的，并且我主要是. NET 开发人员(即使我确实在不同的平台上工作)，必须问一个价值百万美元的问题:当我们有 MS SQL Server、MongoDB 和许多这样的平台时，为什么要使用 Postgres。NET 特定的数据库系统？

好吧，让我们把显而易见的一个放在一边，我已经提到过了:它是免费的。不仅如此，它还是开放的。Postgress 开源许可证允许您对应用程序及其代码做任何您想做的事情。这包括根据您自己的内部目的和特定需求进行定制。

如果定制核心应用程序不适合您，那么它的高度灵活的扩展应用编程接口可以用来创建集成到核心系统中的附加产品，就像它们是一直存在的一个组成部分一样。

## 它还能做什么？

Postgres 多年来开发了一些非常独特的功能，这些功能在其他数据库中根本不存在。我很快会列出其中一些。它还完全 100%符合 ANSI SQL:2008 标准，并在许多不同的平台上运行，包括 Windows 和所有风格的 Linux、Unix，甚至像 Solaris 和所有最新版本的 MacOS。在所有这些平台上安装也很容易；在大多数情况下，这就像安装一个软件包一样简单。

Postgres 也是非常可扩展的，并且在它能实现和不能实现的目标上有一些非常令人印象深刻的上限。

表 1:Postgres 极限

| 限制类型 | 极限值 |
| 最大数据库大小 | 无限的 |
| 最大表格尺寸 | 32tb |
| 最大行大小 | 1.6 万亿字节 |
| 最大字段/列大小 | 1 千兆字节 |
| 每个表的最大行数 | 无限的 |
| 每个表的最大列数 | 250 到 1600，具体取决于列类型 |
| 每个表的最大索引数 | 无限的 |

如你所见，这是一些令人印象深刻的统计数据。之所以如此无限制，是因为 Postgres 将其数据库存储在主机文件系统的常规文件中，因此唯一现实的上限是可用磁盘空间。

Postgres 还有许多不同类型的索引可用于确保高效的数据访问。我将在后面的章节中更详细地介绍这些内容，但目前有以下现成的索引:

*   b 树
*   混杂
*   要点
*   杜松子酒

使用扩展 API 可以很容易地添加新的索引策略，就像添加新的数据类型、表类型、存储类型和许多其他东西一样容易。

接下来，Postgres 也是一个完全面向对象的数据库，这意味着它被设计成以与面向对象编程语言(如 C++和 C#)相同的方式对数据进行建模。

核心产品中的一些特性专门用于支持这种场景，其中最有用的是表继承。

## 表继承

表继承是使用数据库表的过程，其方式类似于开发人员如何在面向对象的应用程序体系结构中扩展功能，允许重用现有数据项，同时向表中添加新数据项。

我举个例子。

假设我们为公司员工准备了以下数据库表:

| 表 | 工作人员的全名 |
| 波段 | 这位工作人员所处的工资级别 |
| 电话号码 | 此人的办公室电话号码 |
| 部门 | 这位工作人员在哪个部门工作 |

这是一个相当简单的标准表定义，是普通数据库中的典型定义。

现在让我们假设每个部门都有自己希望为该部门的每个员工保留的特定属性，并且让我们进一步假设每个部门对这些属性有不同的要求。

例如，信息技术部门可能会增加以下内容:

*   语言发展于
*   选修的课程
*   正在进行的项目
*   拥有的系统

会计部门可能有以下情况:

*   客户负责
*   正在进行的项目
*   支部
*   办公室名称

在大多数数据库系统中，您必须扩展您的数据库表，以确保它包含每个部门所需的所有必需字段:

| **全名** | 工作人员的全名 |
| 大胆〔t1〕 | 这位员工的工资是多少 |
| 电话号码 | 此人的办公室电话号码 |
| **部门** | 这位工作人员在哪个部门工作 |
| **语言** | 该员工可以使用的语言 |
| **课程监控** | 这名工作人员参加的课程 |
| **项目** | 该工作人员参与的项目 |
| **系统** | 该员工负责的系统 |
| **客户** | 该工作人员负责的客户 |
| **子部门** | 这名工作人员属于哪个部门 |
| **$[office name]t1]** | 这位工作人员在哪个区办公室工作 |

开发人员现在不得不长期处理这种情况，那么这有什么关系呢？当您第一次创建数据库时，定义这个很简单，但是在最初创建数据库的几年后，在您的系统中添加一个新的部门呢？

Postgres 通过其表继承能力解决了这个问题。本质上，它允许您正常定义原始人员表。然后，它允许您仅用额外的列定义额外的表，这些列“继承”自原始的人员表。

结果是两个表如下所示:

| **全名** | 工作人员的全名 |
| 大胆〔t1〕 | 这位员工的工资是多少 |
| 电话号码 | 此人的办公室电话号码 |
| **部门** | 这位工作人员在哪个部门工作 |
| **语言** | 该员工可以使用的语言 |
| **课程监控** | 这名工作人员参加的课程 |
| **项目** | 该工作人员参与的项目 |
| **系统** | 该员工负责的系统 |

和

| **全名** | 工作人员的全名 |
| 大胆〔t1〕 | 这位员工的工资是多少 |
| 电话号码 | 此人的办公室电话号码 |
| **部门** | 这位工作人员在哪个部门工作 |
| **项目** | 该工作人员参与的项目 |
| **客户** | 这个工作人员负责照看的客户 |
| **子部门** | 这名工作人员属于哪个部门 |
| **$[office name]t1]** | 这位工作人员在哪个区办公室工作 |

表继承功能不仅仅是节省键入时间。

例如，如果您更改了上一个员工表的**全名**、**工资带**、**电话号码**或**部门**字段，则这些更改将对父员工表和 IT 员工表进行。

这样，您就可以让应用程序根据员工工作的部门过滤其记录，并且只显示该部门所需的数据。如果需要，另一个部门的人仍然可以从他们自己的应用程序中看到那个人的基本细节。

本质上，您将表视为可无限扩展的可重用对象。更重要的是，继承的表可以以同样的方式被进一步继承。

想象一下，在您频繁向应用程序添加新功能的环境中，这有多有用。您可以简单地向数据库添加一个继承的表，然后向数据访问层添加一个新的类，只访问那个新的扩展表，而不是创建脚本将现有的表迁移到一个新的模式，然后可能必须更新许多不同的 ORM 或数据访问机制才能看到新的模式。现有代码将继续正常工作，您的新功能将继续，就像它有了新表一样。

## 是的，还有更多…

直接嵌入到数据库中的多种语言允许您用以下语言编写存储过程(前四种语言是现成的):

*   pgSQL / SQL
*   TCL 集团股份有限公司（TCL Corporation 的缩写）
*   计算机编程语言
*   Perl 语言
*   C
*   C++
*   稀有
*   Java 语言(一种计算机语言，尤用于创建网站)
*   服务器端编程语言（Professional Hypertext Preprocessor 的缩写）
*   红宝石
*   计划

…以及其他许多人。

所有这些过程语言也有正常的第一类语法结构。像 For-Each、Do-While、If-Then 和许多其他构造直接在存储过程中处理全表集，其方式与它们在现实世界中处理普通应用程序的方式完全相同。

这意味着您已经获得的语言技能可以很容易地用于直接在核心产品中开发解决方案。

接下来，我们还有常规数据库列中数组类型的概念。

## 阵列？在数据库里？

是的，所有 Postgres 默认数据类型都可以用作数组类型。

此外，当您有一个数组类型时，所有可用的编程 API 都允许您将您的应用程序与 Postgres 接口，以支持这些操作，而无需任何额外的工作。例如，您可以在 C#中轻松定义以下内容:

```sql
    int[] myIntegers = new int[]{1,2,3,4,5};

```

您可以使用普通的数据访问调用将该数组直接保存到数据库中的数组字段中，然后再检索该数据字段。您的阵列将保持不变，以便您正常使用。

Postgres 还可以在插入和更新时验证您的数据，以确保您只将有效的数据放入数据库。对电子邮件地址、电话号码、正则表达式等的验证已经存在。

到目前为止，我提到的几乎所有东西都是开箱即用的。我们甚至还没有开始触及许多可用扩展的表面，其中许多扩展实际上包含在产品安装的额外贡献文件夹中的核心服务器中。

这些扩展允许您直接在数据库中操作 XML 和 XSLT，添加额外的加密功能，并添加新的数据类型(如图书的 ISBN 号)以及适当的验证规则和逻辑，以确保您的类型包含您期望的内容。

甚至有成熟的特性包可以将 Postgres 转换成完全不同的东西。像 PostGIS 这样的包(本书后面会有完整的一章)将 PostgreSQL 服务器转换成一个成熟的 GIS 数据管理系统，具有与 Oracle Spatial 相同的空间功能。

似乎这还不够，不同平台可用的 Postgres 的不同版本将利用这些平台上可用的特殊设施。例如，Windows 平台有一个 x64 (64 位专用)版本，允许您拥有比前面提到的更大的上限。有一些构建可以跨大规模并行超标量中央处理器架构运行，甚至有一些专门的构建可以使用像图形处理器这样的东西来进行繁重的数字处理。

对于一个免费的系统来说，没有什么理由不选择 Postgres 作为您的应用程序的数据存储，正如您将在后面看到的，使用最新一轮的。NET 数据提供者，服务器可以很好地处理像实体框架 4.1 和更新的东西。

我想说的最后一点是针对那些担心免费产品没有支持的人。

除了明显的开源社区支持之外，企业数据库(照看和运行各种 Postgres 项目的主要公司之一)提供了许多为希望为支持合同付费的公司设计的支持包。他们还为希望为该系统付费的公司提供一些大规模的专业扩展包和扩展。这些额外的包甚至比本书到目前为止描述的那些设施更进一步。

如果你想了解更多，可以在:[http://www.postgresql.org/about/featurematrix/](http://www.postgresql.org/about/featurematrix/)查看完整的特征矩阵页面。