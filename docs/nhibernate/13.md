# 十三、性能优化

## 优化查询

以下是使用 NHibernate 优化查询的一些一般提示:

*   仅选择您需要的属性；也就是说，避免在不需要时选择完整的实体。
*   避免在只需要实体的键时加载实体(使用**isesession)。加载<T>T1 而不是 **ISession。得到< T >** )。**
*   使用分页，而不是同时检索所有记录；所有查询 API 都支持它。
*   在查询时获取您需要的所有引用和集合。
*   谨慎选择懒惰和急切加载，并选择合适的获取模式。如果您确定每次加载特定实体时都需要子集合的项，请将此集合标记为非惰性，并使用提取模式 JOIN。
*   当性能至关重要时，求助于 SQL 查询。

## 优化变革

考虑一下:

*   始终使用显式事务。
*   使用可执行的 HQL 进行批量更新和删除。
*   使用批处理和无状态会话进行插入。
*   从会话中驱逐不需要的实体。
*   将您永远不想更改的实体标记为不可变的，以便会话在跟踪更改时不会浪费时间。
*   使用显式刷新，并在刷新时清除会话或驱逐不需要的实体。
*   在生产中，禁用日志记录和统计。