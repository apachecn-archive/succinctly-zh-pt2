# 第 1 章为什么要构建网络服务器？

现代网络应用程序开发框架，如 ASP.NET 及其三种风格(网络表单、MVC 和网页)和非微软产品，如 Ruby on Rails，都牢牢地夹在网络服务器和您(网络应用程序构建者)之间。在微软世界中，我们习惯于使用 IIS、[<sup>【10】</sup>](Web_Servers_Succinctly_0018.htm#_ftn10)而在 Unix 世界中，通常使用 Apache[<sup>【11】</sup>](Web_Servers_Succinctly_0018.htm#_ftn11)和 Nginx[<sup>【12】</sup>](Web_Servers_Succinctly_0018.htm#_ftn12)。

Rails 这样评价自己:

Rails 是一个 web 应用程序开发框架...旨在通过假设每个开发人员需要开始做什么来简化 web 应用程序的编程。它允许您编写更少的代码，同时完成比许多其他语言和框架更多的工作...Rails 是一个固执己见的软件。它假设有“最好”的做事方式，并旨在鼓励这种方式——在某些情况下是为了阻止替代方法。[<sup>【13】</sup>](Web_Servers_Succinctly_0018.htm#_ftn13)

微软这样说 ASP。NET:

ASP.NET 是一个统一的网络开发模型，它包含了用最少的代码构建企业级网络应用程序所需的服务。[<sup>【14】</sup>](Web_Servers_Succinctly_0018.htm#_ftn14)

关于 ASP.NET 最有价值球员:

ASP.NET MVC 的目标是那些对模式和原则感兴趣的开发人员，比如测试驱动开发、关注点分离、控制反转和依赖注入。这个框架鼓励将 web 应用程序的业务逻辑层与其表示层分开。

通过将应用程序分为模型(M)、视图(V)和控制器(C)，ASP.NET MVC 可以更容易地管理大型应用程序的复杂性。使用 ASP.NET MVC，您可以让多个团队在一个网站上工作，因为业务逻辑的代码与表示层的代码和标记是分开的——开发人员可以处理业务逻辑，而设计人员则处理发送到浏览器的标记和 JavaScript。

我们可以马上看到，开发一个 web 应用程序通常与一个固执己见的框架纠缠在一起，该框架试图规定您应该如何构建该应用程序。

虽然这本书的开头有很多内容要讲，但我想在前面提到，在选择哪一个服务器和服务器“工具集”方面，还有一些额外的复杂性会影响整个决策过程。例如，人们通常可以从各种视图引擎中进行选择。视图引擎是一种服务器端处理工具，用于使用特定的标记语法创建动态网页，通常会导致被亲切地称为“标签汤”的情况[<sup>【15】</sup>](Web_Servers_Succinctly_0018.htm#_ftn15)例如，2010 年推出的 Razor、[<sup>【16】</sup>](Web_Servers_Succinctly_0018.htm#_ftn16)[<sup>【17】</sup>](Web_Servers_Succinctly_0018.htm#_ftn17)或许是可以与 ASP.NET MVC 结合使用的流行视图引擎(至少在撰写本文时是这样)。Rails 自带视图引擎，支持其他视图引擎，如 Slim、[<sup>【18】</sup>](Web_Servers_Succinctly_0018.htm#_ftn18)Rails 社区中超过 24 种不同模板引擎产品[<sup>【19】</sup>](Web_Servers_Succinctly_0018.htm#_ftn19)之一。

另一个需要考虑的问题是，这些框架有自己的想法，即应该如何与数据库接口。换句话说，使用对象关系映射器(ORM)是一个强大的推动力。在 ASP.NET MVC 中，首选的 ORM 是实体框架，而在 Rails 中，ORM 是用活动记录实现的。

所有这些与编写自己的 web 服务器有什么关系？根据维基百科，“网络服务器的主要功能是存储、处理和向客户提供网页。”[<sup>【20】</sup>](Web_Servers_Succinctly_0018.htm#_ftn20)在我看来，这实际上并不正确，但就今天的网络服务器概念而言，这是准确的。这是不正确的，因为从技术上讲，web 服务器应该做的就是将传入的请求交给工作进程——web 应用程序——并以应用程序返回的任何内容进行响应。然而，维基百科的评论是准确的，因为我们看到“网络服务器”的概念与支持的“服务器框架”和“网络应用程序”纠缠在一起

换句话说，向浏览器提供内容实际上包括三个部分:

1.  网络服务器(管理工作人员，也称为线程)，并可能处理诸如白名单和黑名单等前期事务。
2.  根据请求语法，将该请求处理为有意义的实体，如会话状态和路由。
3.  对路由、身份验证请求等的特定于应用程序的响应。

一旦你进入第 2 项，你马上就会遇到固执己见的框架。真的没有中间立场为项目#2 提供最小但有用的实现，这就是本书要解决的问题。这本书是关于创造中间地带的。在这本书里，我们研究了线程化的选项和工作流程的选项，我们还提供了灵活但最小的支架来支持应用程序开发，提供了诸如会话管理、路由和安全性等功能。使用这里介绍的 web 服务器实现应用程序，可以让您更接近金属(这实际上意味着更高的性能和更少的代码)，而不会强制执行过于固执己见的实现需求。

至少，这是我的看法！