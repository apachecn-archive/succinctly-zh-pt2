# 第一章 Windows Azure

## 什么是 Windows Azure？

Windows Azure 是微软数据中心托管的产品和服务的集合，使开发人员和组织能够快速组装适合其应用需求的组件组合。Windows Azure 套件中的工具几乎只关注混合、IaaS 或 PaaS，唯一可能的例外是 Visual Studio Online 产品。所有 Windows Azure 产品的一个关键特征是，客户只为他们使用的东西付费，无论是虚拟机上的中央处理器时间还是持久存储的磁盘空间。对于最初对计算要求非常低的客户来说，这是一个极低的准入门槛，同时也是一个强大的工具，可以控制客户的预算，这些客户的大数据量周期与数据量低得多的周期是分开的。

## Windows Azure 服务

微软根据其提供的服务类型将 Windows Azure 产品分为四大类。在本节中，我们将简要讨论每个类别中的服务，更详细地讨论在构建 Windows Azure 网站时更可能遇到的那些服务。如果您已经熟悉 Azure 中提供的各种服务，或者只是希望在进行过程中发现它们，您可以放心地跳过阅读这一部分。

### 计算

计算服务是专注于利用微软数据中心硬件中的 CPU 能力的产品。这些都是基于中央处理器内核和可用随机存取存储器的组合定价的，并且共享相同的运行状况监控和自动扩展功能，以灵活的方式满足客户需求，同时仍能控制成本。

#### 虚拟计算机

虚拟机是计算类别中唯一被视为 IaaS 产品的产品。借助虚拟机，您可以在微软的数据中心运行专用虚拟服务器，从许多预定义的模板开始，甚至可以上传您自己的虚拟硬盘(VHD)，其中包含您创建的配置。这些机器可以自己运行，也可以参与生态系统，与平台即服务解决方案协同互动。

#### 网站

Windows Azure 网站产品专注于提供一套有针对性的服务，允许使用使网站变得有用所需的许多功能来创建和维护网站。这包括对各种服务器端技术的支持，包括 ASP.NET、经典 ASP、PHP、Node.js 和 Python，还包括一个 Windows Azure SQL 数据库或 MySQL，为您的应用程序提供后备存储。与虚拟机产品一样，应用程序所有者可以携带自己的定制应用程序，也可以从基于应用程序库中流行框架的越来越多的网站模板中进行选择。

#### 移动服务

移动服务是一组服务，旨在提供最常用的服务器端功能，为移动应用提供动力。这些服务使开发人员有机会快速添加功能，例如:

*   云存储，以确保您的应用程序用户可以相互共享，并且用户的应用程序状态可以跟随他们从一个设备到另一个设备。
*   身份认证与许多流行的身份提供商集成，如谷歌、微软、脸书、推特或 Azure 中托管的活动目录。
*   当应用程序中发生重要事件时，推送通知允许您的服务器端代码通过广播到达数百万台设备。

对于本书的读者来说，重要的是要注意，尽管这些服务是作为面向移动设备的服务进行营销的，但其中许多服务在开发高度交互的网络 2.0 应用程序时非常有用。

#### 云服务

云服务是可执行代码的运行时容器，通常用于为可能在桌面、移动设备甚至其他服务器上运行的应用程序创建后端服务层，并为以允许应用程序直接部署到 Azure 服务的方式构建的应用程序提供管理虚拟机的替代方案。这些服务通常用于创建应用程序组件，称为工作角色或网络角色。工作角色是作为独立进程运行的应用程序组件，执行没有用户界面(UI)的任务，而网络角色与工作角色共享相同的运行时特性，但添加了可在互联网上公开寻址的特性，以便作为 UI 或公共服务 API。云服务是许多企业应用程序不可或缺的一部分，但对于许多中小型网站来说并不是必需的，因为 Azure 在 Azure 网站产品中提供了满足其需求的功能。

### 数据服务

Azure 成功背后的驱动力之一是，微软解释了一个事实，即没有人回答“什么是 __ 的最佳工具？”相反，许多选择可用于完成大多数任务，以允许架构师在完整的上下文中审查需求，并确定解决在云中开发现代应用程序时出现的挑战的最佳(有时甚至是最差)方法。当查看在选择应用程序如何存储和检索数据时所做的选择时，这一点非常明显。架构师可以检查以下问题:

*   需要多快检索数据？
*   需要存放多长时间？
*   会有多少数据？
*   数据的结构会有多一致？
*   数据需要有多容易搜索？

对于这些问题以及更多问题，有各种各样的存储工具可以为您的应用程序需求提供量身定制的解决方案，要么使用单一工具，要么可能构建一个结合多种工具优势的解决方案。

#### 蔚蓝存储

Azure Storage 实际上是 Azure 数据服务的一个子集，它本身包含几种不同类型的存储机制，每种机制都旨在解决不同的存储问题:

*   Blob 存储用于存储非结构化数据，可被视为类似于桌面电脑上的文件系统。由于并非所有文件在针对云进行优化时都有相同的需求，blob 存储进一步分为两种类型:
*   块 blobs 用于存储可以顺序访问且不会频繁更新的文件。利用 Block blobs 的一些常见示例包括视频文件和图像。
*   页面 blobs 用于存储需要随机访问或经常更新的文件。
*   Azure 表存储提供了高度可扩展的 NoSQL 数据库选项。存储在 Azure Tables 中的数据可以通过许多流行语言的软件开发工具包(SDK)来访问，也可以通过不需要使用 SDK 的 REST API 来访问。
*   Azure Queues 用于存储计划由解决方案中的另一个组件使用的数据，并且在接收组件使用后不需要保存。排队对云应用程序的重要性将在本书后面更详细地讨论。

#### 蓝色数据库

Azure SQL 数据库可以被合理地认为是微软 SQL Server 向云的扩展。删除了一些不能很好地扩展到云解决方案的功能后，大多数使用微软 SQL Server 构建的内部应用程序都将转移到 Azure SQL 数据库，无需任何修改。

#### 后见之明

HDInsight 是一项基于 Apache Hadoop 平台的服务。HDInsight 用于存储和访问大量结构化和非结构化数据(通常称为大数据)。该工具的一个常见用例是将数据存储在仓库中，以便使用业务智能工具(如 PowerPivot)进行分析。

#### 蔚蓝缓存

Azure Cache 用作一个临时存储，用于保存检索成本可能很高的数据，并在应用程序中频繁使用，使其接近需要的位置，而不必在再次需要时再次承担后续检索的成本。Azure 的解决方案可以将缓存保留在应用程序的工作角色中，也可以将其用作共享缓存，供解决方案的其他组件使用。

#### Azure 备份

Azure Backup 是一种基础架构工具，用于为您的内部服务器数据提供异地备份，提供额外的功能，如版本控制和自动执行数据保留策略。

#### 蔚蓝网站恢复

Azure 站点恢复(以前的 Azure Hyper-V 恢复管理器)是一种基础架构工具，用于将运行在内部数据中心的私有云提供到单独位置的异地复制，并在主位置发生故障时协调从辅助位置的恢复。

### 应用服务

应用程序服务是一套工具，应用程序开发人员可以利用这些工具为他们的解决方案添加功能，而无需花费大量时间和精力来解决其他人已经解决的常见问题。这些服务允许开发人员编写只有他们才能编写的代码，并专注于直接导致他们试图用应用程序解决的问题的事情。给定的网站可能需要任何数量的这些服务。与数据服务一样，许多应用服务与其他应用服务有一定程度的重叠，这要求架构师在为给定的工作确定合适的工具时，彻底考虑工具的优缺点以及成本。

#### 蔚蓝媒体服务

媒体内容的处理是许多应用程序开发人员可以专攻的一个问题领域，也是他们整个职业生涯的重点，因为这是一个复杂而动态的问题领域。除了处理各种编码方法和确保以与消费代理兼容的方式传递内容的复杂性之外，媒体内容的大多数应用还需要保护内容免受未经授权的使用、授权使用的货币化以及衡量内容如何使用的方法。Azure Media Services 提供工具和应用编程接口来处理所有这些任务，无论是作为独立服务还是与您的解决方案集成。使用 Azure Media Services 的应用程序的示例可能包括广播公司将体育赛事直播流式传输给互联网订户，或者内容提供商将受数字版权管理(DRM)保护的内容出租给客户，该内容可在有限的时间内观看。

#### 蔚蓝服务巴士

Azure 服务总线主要被认为是比 Azure 存储队列更健壮的排队机制。服务总线用于在应用程序之间提供消息传递，无论它们是在同一个 Azure 解决方案中，还是另一个 Azure 解决方案的一部分，或者是内部组件与云组件交互的混合解决方案。Azure 服务总线允许这些组件之间的松散耦合，这允许巨大的可伸缩性，如果系统中某个组件的实现需要完全返工，也允许灵活性。Azure 服务总线将在专门的排队章节中讨论。

#### 通知中心

通知中心为解决方案中的组件提供了一个发布/订阅框架，以便向所有客户端广播消息或将这些消息仅定向到特定客户端。发布/订阅是可扩展应用程序的一种重要模式，也很容易成为它自己的书的主题。因此，希望将自己的技能转移到云的开发人员如果不熟悉这种模式，应该花时间去了解它。

#### Azure 计划程序

Azure Scheduler 是一个简单的工具，可以设置作业以供执行，并在应用程序的执行路径之外运行。计划作业可以调用 HTTP web 服务，也可以将消息发布到存储队列。典型的用例包括执行数据管理任务(如预聚合数据或清除临时存储)和与外部服务的批处理通信。

#### Azure BizTalk 服务

由于 Azure SQL 数据库是微软 SQL Server 工具的云演进，因此 Azure BizTalk Services 将微软 BizTalk Server 集成平台带到了 Azure。该工具主要用于处理企业应用程序平台(如 SAP 和 PeopleSoft)之间的复杂集成，或者业务之间的复杂集成，如电子数据交换(EDI)交易处理。

#### Visual Studio 联机

当涉及到被微软归类为应用服务的工具时，Visual Studio Online 有点离群，因为它不是提供运行时服务来为应用程序添加功能，而是用于应用程序的实际创建。Visual Studio Online 提供了以集中或分布式方式(通过 Git 或 Team Foundation 版本控制)托管源代码存储库、计划和跟踪项目、管理测试周期以及评估应用程序的初始和持续性能的工具。

#### 蔚蓝活动目录

Azure Active Directory 提供身份验证和授权服务，可以是独立的，也可以通过同步或联合与本地 Active Directory 集成。

#### 多因素身份验证

多因素身份验证用于解决通常由泄露的密码引起的问题，提供的步骤不仅仅是为用户提供密码来证明他们的身份。这些步骤通常涉及系统生成的临时密码，该密码被发送到已知属于用户的设备或电话，该用户的凭证正通过移动应用程序、文本消息或电话来使用。

### 网络服务

Azure 网络服务旨在为 IT 专业人员提供支持，以实现网络配置，从而支持和优化在其 Azure 帐户内或与内部解决方案结合运行的应用程序。这些服务不直接适用于构建 Azure 网站，但在此列出并简要描述，以便为解决方案开发人员提供生态系统中可用工具的完整视图。

#### 蓝色快车路线

Azure ExpressRoute 是一种通过网络服务提供商提供的高级工具，它提供与 Azure 数据中心的直接连接，而不是通过公共互联网连接。当可靠性、速度或安全性要求证明维持直接连接的成本合理时，就使用这种方法。

#### 蔚蓝虚拟网络

Azure 虚拟网络允许 Azure 数据中心托管的资源与内部资源存在于同一逻辑网络中。这在构建混合应用程序时非常有用，其中应用程序的组件必须位于同一网络上。

#### 蔚蓝交通管理器

Azure 流量管理器是一个负载平衡解决方案，用于控制到达 Azure 服务的请求的分布。这可用于增加容错能力和/或提高应用程序的性能。例如，Azure Traffic Manager 可以使用一种称为循环的平衡策略在一组目的地之间循环，以便在用于提高性能时保持服务器之间的负载均衡(假设每个请求产生的负载量与另一个相同)。Azure 流量管理器可以使用运行状况监控来检测您的服务的一个实例已经停止运行，并将流量重定向到另一个实例以实现容错。

## 开始使用天蓝色

在您可以开始在 Azure 上开发网站之前，需要采取一些步骤，包括设置开发环境和获取 Azure 帐户。在本节中，我们将介绍让开发人员在 Azure 平台上启动并运行所需的基础知识。

### 为云开发做好准备

这似乎是一个显而易见的步骤，但是作为一名开发人员，当您准备冒险在 Azure 上开发解决方案时，您应该做的第一件事是熟悉适用于在云中制作成功应用程序的工具、技术和模式。读这本书是第一步。另一个非常有价值的资源是微软 MSDN 网站([http://msdn.microsoft.com](http://msdn.microsoft.com))的模式和实践部分，其中包括一组云开发主题，专门讨论特别适用于云环境的问题和解决方案模式。此外，微软和其他公司赞助了许多免费的、面对面的和虚拟的培训机会，如代码营和微软虚拟学院([http://www.microsoftvirtualacademy.com](http://www.microsoftvirtualacademy.com))。此外，还有许多流行的在线付费培训机会。

| ![](../Images/note.png) | 注意:本节中引用的网址在撰写本文时是最新的，但可能不会随着时间的推移而保持一致。如果读者无法访问任何网址，我建议使用您选择的搜索引擎搜索当前位置。此外，在页面工作流中要采取的操作(如注册向导)将尽可能笼统地描述，因为微软可能会随时更改步骤。 |

### 为 Azure 开发设置您的机器

设置本地开发环境的步骤可能会有很大的不同，这取决于您将用来创建应用程序的工具以及将在您的解决方案中使用的各个 Azure 服务。在本节中，我们将介绍使用 Visual Studio 2013 构建网站的最基本设置。

#### 安装 Visual Studio 2013

如果你还没有它，第一步是得到你的。基于. NET 的开发环境的建立是为了获取和安装 Visual Studio 2013。Visual Studio 有许多版本，从免费的 Visual Studio Express 2013 产品到价格优惠的 Visual Studio Ultimate 2013。许多资料来源比较了该工具不同版本中可用的特性，因此本书将不讨论这些细节。Visual Studio 2013 可在[http://www.visualstudio.com/downloads](http://www.visualstudio.com/downloads)下载。您可以选择下载免费的快速版或付费版的试用版。本书中的所有描述和屏幕截图都是使用 Visual Studio 2013 Premium 创建的，但是 Visual Studio Express 2013 for Web 应该足以创建和使用 Azure 网站。

#### 安装 Azure 软件开发工具包

安装了 Visual Studio 后，您就可以为安装 Azure 工具了。NET 和 Visual Studio。对于如何获取和安装 SDK，有不止一个选项，但是为了本书的目的，我们将讨论直接下载选项。Azure SDK 和工具下载可在[http://azure.microsoft.com/en-us/downloads](http://azure.microsoft.com/en-us/downloads)获得。对于 Visual Studio 2013，您将希望选择“VS 2013 安装”链接，然后运行下载的可执行文件并按照提示操作。

#### 安装命令行工具

除了 SDK 和 Visual Studio 工具之外，您很可能会发现安装 Azure 命令行工具的价值，这些工具也可以在[http://azure.microsoft.com/en-us/downloads](http://azure.microsoft.com/en-us/downloads)获得。在“命令行工具”标题下，您将找到一个 Windows PowerShell 下载和 Azure 命令行界面安装程序以及每个安装程序的文档。Azure 命令行界面工具可以为视窗、苹果或 Linux 下载。

### 注册天蓝色

要在 Azure 上建立帐户，您需要首先拥有一个微软帐户。如果您还没有微软帐户，您需要创建一个。假设你已经有一个微软账号，去[http://windows.azure.com](http://windows.azure.com)。如果您尚未登录到您的 Microsoft 帐户，请按照提示登录。登录后，选择注册 Azure 的选项(在撰写本文时，这是在标有“立即注册”的页面上发出的行动号召)。这将提供几个可供选择的选项，包括免费试用、现收现付选项，以及一些面向预期利用率更高且希望从预付费服务的批量折扣中受益的企业的预付费选项。对于这本书的读者来说，我建议在可用的情况下选择免费试用。选择所需选项后，按照提示提供所需信息并完成注册过程。

| ![](../Images/note.png) | 注意:请密切关注您所提供信息的细节，并确保您了解与您所使用的服务相关的成本。如果您提供了信用卡号等支付详细信息，但没有选择支出限额，您可能会发现自己对收到的账单感到惊讶，因为您激活了这些服务以进行探索，但随后没有停止使用。 |

完成注册过程后，您可以访问 Windows Azure 管理门户，在[http://manage.windowsazure.com](http://manage.windowsazure.com)管理您的帐户、订阅和服务。

## 总结

在本章中，您了解了 Azure 平台上提供的许多服务，并更加关注那些在创建 Azure 网站时可能特别有价值的服务。您还学习了如何准备自己和您的开发环境，以成功构建要在 Azure 平台上运行的应用程序。当您在 Azure 平台上创建和编程网站时，这些知识以及您现在已经设置的帐户(如果您实际上没有设置帐户，您需要这样做才能从本书中充分受益)将在以下章节中使用和构建。