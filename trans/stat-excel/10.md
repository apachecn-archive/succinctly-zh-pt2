# 第十章相关性和协方差

## 基本定义

两个样本随机变量![](../Images/image298.png)和![](../Images/image299.png)之间的**样本协方差**是两个变量之间线性关联的度量，由以下公式定义:

![](../Images/image300.png)

协方差类似于方差，除了协方差是为两个变量(![](../Images/image301.png)和![](../Images/image299.png))定义的，而方差只为一个变量定义。事实上，![](../Images/image302.png)

两个样本变量![](../Images/image301.png)和![](../Images/image299.png)之间的**相关系数**是两个变量之间线性关联的无标度度量，由以下公式定义:

![](../Images/image303.png)

如果有必要，我们可以将![](../Images/image304.png)写成![](../Images/image305.png)来显式显示这两个变量。我们也用**决定系数**来表示![](../Images/image306.png)。

如果![](../Images/image307.png)接近 1，则![](../Images/image298.png)和![](../Images/image299.png)正相关。A **正线性相关**表示![](../Images/image308.png)的高值与![](../Images/image309.png)的高值相关，![](../Images/image299.png)的低值与![](../Images/image301.png)的低值相关。

如果![](../Images/image304.png)接近-1，那么![](../Images/image301.png)和![](../Images/image299.png)是负相关的。A **负线性相关**表示![](../Images/image308.png)的高值与![](../Images/image301.png)的低值相关联，![](../Images/image299.png)的低值与![](../Images/image301.png)的高值相关联。

当![](../Images/image304.png)接近 0 时，![](../Images/image301.png)和![](../Images/image299.png)之间几乎没有线性关系，即![](../Images/image301.png)和![](../Images/image299.png)是**独立的**。

## 散点图

为了更好地可视化两个数据集![](../Images/image310.png)和![](../Images/image311.png)之间的关联，我们可以使用称为**散点图**的图表(也称为**散点图**)。

**例**:一项旨在检验吸烟与长寿之间关系的研究。抽取了 15 名 50 岁以上的男性样本。记录每天平均吸烟量和死亡年龄，如图 66 左侧所示。创建一个散点图来显示吸烟数量和人的寿命之间的关联程度。

![](../Images/image312.jpg)

图 66:散点图

具体如下:

1.突出显示 A4:B18 范围，并选择**插入>图表|散点图**

2.**设计**、**布局**和**格式**功能区现在出现，帮助您完善图表。任何时候，您都可以单击图表来访问这些功能区。

生成的图表显示在图 66 的右侧，尽管最初图表不包含图表标题或坐标轴标题。我们补充如下:

3.要添加图表标题，点击图表，选择**布局>标签|图表标题**，然后选择图表上方的**，输入标题长寿诉香烟。**

 **4.通过选择**布局>标签|轴标题>主横轴标题>轴下标题**并输入吸烟数量(每天)，可以以类似的方式添加横轴标题。

5.纵轴标题通过选择**布局>标签|轴标题>主纵轴标题>旋转标题**并输入预期寿命(年)来添加

6.默认图例不是特别有用，因此您可以通过选择**布局>标签|图例>无**将其删除

由于长寿的最小值是 53，如果我们提高横轴，图表会显示得更好。具体如下:

7.双击垂直轴(0 到 100)。**格式轴**将出现，如图 67 所示。确保选择了**轴选项**选项卡，并将**最小值**字段从**自动**更改为**手动**，然后输入值 50。点击**关闭**:

![](../Images/image313.png)

图 67:格式化轴对话框

最后，我们添加最适合数据点的直线，如下所示:

8.选择**布局>分析|趋势线>线性趋势线**

如果需要，可以通过左键单击图表并将其拖动到所需位置，在工作表中移动图表。您也可以通过单击图表的一个角并拖动该角来更改尺寸，从而调整图表的大小，使其变小或变大。要保证长宽比(即长宽比)不变，拖动边角时按住 **Shift** 很重要。

从图 66 的散点图来看，长寿和吸烟之间呈负线性关系。

## Excel 函数

Excel 为具有相同元素数量的 R1 和 R2 区域提供了以下工作表函数:

**协方差。p**(R2 R1)= R1 范围内的数据和 R2 范围内的数据之间的总体协方差

**协方差。s**(R2 R1)= R1 范围内的数据和 R2 范围内的数据之间的样本协方差

**CORREL**(R2 R1)= R1 范围数据与 R2 范围数据的相关系数

**RSQ** (R1、R2)= R1 和 R2 范围内数据之间的决定系数；这相当于公式=CORREL(R1，R2) ^ 2

请注意，不需要区分总体和样本相关系数，因为它们具有相同的值。

协方差。p 和协方差。仅在从 Excel 2010 开始的 Excel 版本中有效。对于以前的版本，Excel 只为总体协方差提供一个函数，即 COVAR(R1，R2)，它相当于协方差。P(R1、R2)。样本协方差可以使用以下公式计算:

=n * COVAR(R1，R2)/(n–1)

其中 n = R1(或 R2)的元素数量

对于图 66 所示的数据，协方差为-97.44，相关系数为-0.71343。这些值通过以下公式计算:

=协方差。S(A4:A18，B4:B18)

=CORREL(A4:A18，B4:B18)

## 缺少数据的 Excel 函数

请注意，在计算 CORREL(R1，R2)或本章中描述的任何协方差函数时，任何对中的一个或两个元素都是非数字的对都将被忽略。

**例**:根据图 68 的数据计算吸烟与寿命的相关性:

![](../Images/image314.png)

图 68:缺失数据的相关系数

图 68 中的数据与图 66 中的数据相同，只是增加了两个样本元素(第 11 行和第 15 行)，其中一对元素中的一个是空白的。由于忽略了这些元素，=CORREL(A4:B20)得出的值为-71343，与我们根据图 66 中的数据计算的值相同。

## 假设检验

了解吸烟和长寿之间是否有显著的相关性是很有用的。相关性为 0 表示吸烟和寿命是独立的(也就是说，不存在关联)。由于观测到的相关系数-71343 与 0 相差甚远，因此从数据来看，存在负相关。但我们想知道这是否有意义，还是由于随机效应。

原来，当总体相关为 0 时，写成 *ρ* = 0(即![](../Images/image301.png)和![](../Images/image299.png)是独立的)，那么对于足够大的样本量 n 值，样本相关![](../Images/image304.png)将近似正态分布。因此，我们可以使用 n–2 个自由度的 t 检验，其中:

![](../Images/image315.png)和![](../Images/image316.png)

这里![](../Images/image317.png)是![](../Images/image307.png)的标准误差。

**例**:判断吸烟与长寿是否有显著相关性。

分析如图 69 所示:

![](../Images/image318.png)

图 69:相关系数的假设检验

根据图 69 中的结果(p 值= 0.002822 < .05 = α), we reject the null hypothesis that *ρ* = 0，得出吸烟与长寿有显著相关性的结论。值得注意的是，这种相关性并不意味着我们可以声称吸烟会导致寿命降低。例如，也许还有一些其他因素会导致一个人吸烟和寿命缩短。

如果 *ρ* ≠ 0，那么前面描述的方法将不起作用，因为即使对于大的 n 值，样本相关性![](../Images/image304.png)也不是近似正态分布的。幸运的是，有一个相关系数的转换将解决这个缺陷。

对于任何![](../Images/image304.png)，定义![](../Images/image304.png)的**费希尔变换**如下:

![](../Images/image319.png)

对于足够大的 n，大小为 n 的样本的相关系数![](../Images/image304.png)的费希尔变换![](../Images/image320.png)具有标准偏差的正态分布:

![](../Images/image321.png)

Excel 提供了计算费希尔变换及其逆变换的函数。

**fisher**(![](../Images/image322.png))= . 5 * ln((1+![](../Images/image322.png))/())

**FISHERINV**(![](../Images/image323.png))=(EXP(2 *![](../Images/image323.png))–1)/(EXP(2 *![](../Images/image323.png))+1)

**例**:测试图 66 中数据的相关系数是否与-0.5 有显著差异；

![](../Images/image324.png)

图 70:使用费希尔变换的假设检验

从图 70 中，我们看到总体相关系数和-5 之间没有显著差异(p 值= 0.098485 > .05 = α)。虽然这不是特别有用的信息，但是总体相关系数的 95%置信区间的计算是有用的。该置信区间计算如下:

![](../Images/image325.png)

![](../Images/image326.png)

我们看到 95%的置信区间是(-.889，-0 . 354)。请注意，0 不在此区间内，这再次证明相关系数与 0 显著不同(如前所示)。由于-5 在这个区间，我们不能排除实际人群相关系数为-5(置信度为 95%)。

## 数据分析工具

Excel 提供了**相关性**数据分析工具来计算多个变量的成对相关系数。

**例**:计算图 71 中数据的成对相关系数和协方差；

![](../Images/image327.jpg)

图 71:样本数据

我们使用 Excel 的**关联**数据分析工具，从显示的菜单中选择**数据>分析|数据分析**并选择**关联**。出现图 72 所示的对话框:

![](../Images/image328.png)

图 72:相关数据分析工具的对话框

使用 Excel 的**相关**数据分析工具，我们可以计算出图 71 表格中所示的各种变量的成对相关系数。结果如图 73 所示:

![](../Images/image329.jpg)

图 73:成对相关系数

同样，我们使用 Excel 的**协方差**数据分析工具获取协方差，如图 74 所示:

![](../Images/image330.jpg)

图 74:成对协方差**